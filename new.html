<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Attendance</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h2 { background: #007bff; color: white; padding: 8px 12px; border-radius: 5px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 30px; background: white; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    th, td { padding: 8px 12px; border: 1px solid #ddd; text-align: left; }
    th { background: #f2f2f2; }
    input, button, select { padding: 6px; margin: 4px 0; }
    .add-form { margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
  </style>
</head>
<body>

<h1>Attendance System</h1>

<div class="add-form">
  <input type="text" id="studentName" placeholder="Student Name">
  <input type="text" id="studentID" placeholder="Student ID">

  <button id="add">Add Attendance</button>
</div>
<div id="attendanceTables"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
import { getFirestore, collection, onSnapshot, addDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDXYuGsHV-u8HzDbBCrLDJAhTAYdSDjI8Q",
  authDomain: "attendence-bc81d.firebaseapp.com",
  projectId: "attendence-bc81d",
  storageBucket: "attendence-bc81d.firebasestorage.app",
  messagingSenderId: "804910602579",
  appId: "1:804910602579:web:eb61bbb3a2c6b1ef1229a6",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ================== ADD ATTENDANCE ==================
document.getElementById("add").addEventListener("click", async () => {
  const name = document.getElementById('studentName').value.trim();
  const studentID = document.getElementById('studentID').value.trim();
  if (!name || !studentID) return alert("Enter both name and ID");

  await addDoc(collection(db, "cities"), {
    student_name: name,
    country: studentID,
    time: new Date().toString()
  });

  alert("Attendance added!");
  document.getElementById('studentName').value = '';
  document.getElementById('studentID').value = '';
});

// ================== GET DATA & CREATE DATE TABLES ==================
function getData() {
  const attendanceDiv = document.getElementById("attendanceTables");

  onSnapshot(collection(db, "cities"), (snapshot) => {
    const groupedByDate = {};

    snapshot.forEach(doc => {
      const data = doc.data();
      // Extract date part only (first 4 parts of string)
      const dateStr = data.time.split(" ").slice(0,4).join(" "); // e.g. "Wed Oct 15 2025"
      if (!groupedByDate[dateStr]) groupedByDate[dateStr] = [];
      groupedByDate[dateStr].push(data);
    });
// console.log(groupedByDate);

    // Clear previous tables
    attendanceDiv.innerHTML = "";

    // Loop through each date and create table
    Object.keys(groupedByDate).sort().forEach(date => {
      const table = document.createElement("table");

      // Table header
      table.innerHTML = `
        <thead>
          <tr><th colspan="3" style="background:#007bff;color:white;padding:5px">${date}</th></tr>
          <tr>
            <th style="border:1px solid #ddd;padding:5px">Student Name</th>
            <th style="border:1px solid #ddd;padding:5px">Student ID</th>
            <th style="border:1px solid #ddd;padding:5px">Time</th>
          </tr>
        </thead>
        <tbody>
          ${groupedByDate[date].map(item => `
            <tr>
              <td style="border:1px solid #ddd;padding:5px">${item.student_name}</td>
              <td style="border:1px solid #ddd;padding:5px">${item.country}</td>
              <td style="border:1px solid #ddd;padding:5px">${new Date(item.time).toLocaleTimeString()}</td>
            </tr>
          `).join('')}
        </tbody>
      `;

      attendanceDiv.appendChild(table);
    });
  });
}

getData();
</script>
<script src="app.js"></script>
</body>
</html>
